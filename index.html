<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle Financeiro PJ</title>
  <style>
    :root {
      --primary-color: #6366F1;
      --primary-dark: #4F46E5;
      --primary-light: #A5B4FC;
      --success-color: #10B981;
      --success-light: #6EE7B7;
      --warning-color: #F59E0B;
      --warning-light: #FCD34D;
      --danger-color: #EF4444;
      --danger-light: #FCA5A5;
      --gray-50: #F8FAFC;
      --gray-100: #F1F5F9;
      --gray-200: #E2E8F0;
      --gray-300: #CBD5E1;
      --gray-400: #94A3B8;
      --gray-500: #64748B;
      --gray-600: #475569;
      --gray-700: #334155;
      --gray-800: #1E293B;
      --gray-900: #0F172A;
      --text-color: var(--gray-900);
      --bg-color: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card-bg: rgba(255, 255, 255, 0.95);
      --border-radius: 16px;
      --border-radius-lg: 20px;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --glassmorphism: backdrop-filter: blur(20px);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      padding-bottom: 80px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animação de partículas de fundo */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(120, 255, 198, 0.3) 0%, transparent 50%);
      z-index: -1;
      animation: floatParticles 20s ease-in-out infinite;
    }

    @keyframes floatParticles {
      0%, 100% { opacity: 0.3; transform: translateY(0px); }
      50% { opacity: 0.5; transform: translateY(-20px); }
    }

    .container {
      padding: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Loading */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      var(--glassmorphism);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--gray-200);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Cards com glassmorphism */
    .card {
      background: var(--card-bg);
      var(--glassmorphism);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-xl);
      padding: 2rem;
      margin-bottom: 1.5rem;
      transition: var(--transition);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    }

    .card:hover {
      box-shadow: var(--shadow-xl);
      transform: translateY(-4px) scale(1.01);
      border-color: rgba(255, 255, 255, 0.3);
    }

    /* KPI Cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .kpi-card {
      text-align: center;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      border: none;
      position: relative;
      overflow: hidden;
    }

    .kpi-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
    }

    .kpi-value {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
      position: relative;
      z-index: 1;
    }

    .kpi-label {
      font-size: 1rem;
      opacity: 0.9;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }

    /* Navegação por abas */
    .tab-bar {
      display: flex;
      justify-content: space-around;
      background: rgba(255, 255, 255, 0.95);
      var(--glassmorphism);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      box-shadow: 0 -10px 25px rgba(0, 0, 0, 0.1);
    }

    .tab-item {
      flex: 1;
      text-align: center;
      padding: 12px 8px;
      font-size: 12px;
      color: var(--gray-500);
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: var(--transition);
      position: relative;
      cursor: pointer;
      font-weight: 500;
    }

    .tab-item:hover {
      color: var(--primary-color);
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(165, 180, 252, 0.1));
      transform: translateY(-2px);
    }

    .tab-item.active {
      color: var(--primary-color);
      font-weight: 700;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(165, 180, 252, 0.15));
    }

    .tab-item.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      border-radius: 0 0 4px 4px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { width: 0; }
      to { width: 40px; }
    }

    /* Ícones melhorados */
    .tab-icon {
      width: 24px;
      height: 24px;
      fill: currentColor;
      transition: var(--transition);
    }

    .tab-item:hover .tab-icon {
      transform: scale(1.1);
    }

    .tab-item.active .tab-icon {
      transform: scale(1.1);
      filter: drop-shadow(0 2px 4px rgba(99, 102, 241, 0.3));
    }

    /* Títulos */
    h1 {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 2rem;
      text-align: center;
      position: relative;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      border-radius: 2px;
    }

    .title {
      font-size: 1.375rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--gray-800);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Botões melhorados */
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 14px 28px;
      border-radius: var(--border-radius);
      text-decoration: none;
      color: white;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .button:hover::before {
      left: 100%;
    }

    .button:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: var(--shadow-xl);
    }

    .button:active {
      transform: translateY(-1px) scale(0.98);
    }

    .button.secondary {
      background: linear-gradient(135deg, var(--gray-500), var(--gray-600));
    }

    .button.is-fullwidth {
      width: 100%;
      margin-bottom: 1.5rem;
    }

    /* Quick Actions melhoradas */
    .quick-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .quick-action-btn {
      padding: 1.5rem;
      text-align: center;
      border-radius: var(--border-radius-lg);
      background: var(--card-bg);
      var(--glassmorphism);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: var(--gray-700);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
    }

    .quick-action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(165, 180, 252, 0.1));
      opacity: 0;
      transition: var(--transition);
    }

    .quick-action-btn:hover::before {
      opacity: 1;
    }

    .quick-action-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
      transform: translateY(-6px) scale(1.05);
      box-shadow: var(--shadow-xl);
    }

    .quick-action-btn .icon {
      width: 32px;
      height: 32px;
      margin-bottom: 8px;
      transition: var(--transition);
    }

    .quick-action-btn:hover .icon {
      transform: scale(1.2) rotate(5deg);
    }

    /* Formulários melhorados */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 0.75rem;
      font-size: 14px;
      position: relative;
    }

    .input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--gray-200);
      border-radius: var(--border-radius);
      font-size: 14px;
      transition: var(--transition);
      background: white;
      color: var(--gray-700);
    }

    .input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      transform: scale(1.02);
    }

    .input:hover {
      border-color: var(--gray-300);
    }

    /* Modais melhorados */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      var(--glassmorphism);
      display: flex;
      justify-content: center;
      align-items: flex-end;
      z-index: 10000;
      animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: var(--card-bg);
      var(--glassmorphism);
      border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
      padding: 2rem;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      border: 1px solid rgba(255, 255, 255, 0.3);
      animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes modalSlideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    /* Lista de itens melhorada */
    .list-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: var(--border-radius);
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid var(--gray-100);
      transition: var(--transition);
      cursor: pointer;
      border-radius: var(--border-radius);
      margin-bottom: 0.5rem;
    }

    .list-item:hover {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(165, 180, 252, 0.05));
      transform: translateX(4px);
    }

    .item-info {
      flex: 1;
    }

    .item-label {
      font-weight: 600;
      color: var(--gray-800);
      margin-bottom: 0.25rem;
    }

    .item-description {
      font-size: 0.875rem;
      color: var(--gray-500);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .item-value {
      font-weight: 700;
      font-size: 1rem;
      padding: 0.5rem 1rem;
      border-radius: var(--border-radius);
    }

    .item-value.positive {
      color: var(--success-color);
      background: rgba(16, 185, 129, 0.1);
    }

    .item-value.negative {
      color: var(--danger-color);
      background: rgba(239, 68, 68, 0.1);
    }

    /* Estados vazios melhorados */
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--gray-400);
    }

    .empty-state div:first-child {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.7;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .empty-state p {
      font-size: 1.125rem;
      font-weight: 500;
      margin: 0;
    }

    /* Notificações melhoradas */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: var(--border-radius);
      color: white;
      font-weight: 600;
      z-index: 10001;
      box-shadow: var(--shadow-lg);
      animation: notificationSlide 0.3s ease-out;
      max-width: 300px;
    }

    @keyframes notificationSlide {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .notification.success {
      background: linear-gradient(135deg, var(--success-color), var(--success-light));
    }

    .notification.error {
      background: linear-gradient(135deg, var(--danger-color), var(--danger-light));
    }

    /* Views com animações */
    .view {
      animation: viewFadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes viewFadeIn {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .hidden {
      display: none !important;
    }

    /* Form row */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 2rem;
    }

    /* Responsividade melhorada */
    @media (min-width: 768px) {
      .container {
        padding: 2rem;
      }

      .modal {
        align-items: center;
      }

      .modal-content {
        width: 90%;
        max-width: 500px;
        border-radius: var(--border-radius-lg);
        max-height: 90vh;
        animation: modalZoomIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes modalZoomIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }

      .tab-bar {
        position: relative;
        bottom: auto;
        border-top: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: var(--shadow-sm);
        margin-bottom: 2rem;
        border-radius: var(--border-radius-lg);
      }

      .tab-item {
        font-size: 14px;
        padding: 20px 24px;
      }

      .tab-item.active::before {
        bottom: 0;
        top: auto;
        border-radius: 4px 4px 0 0;
      }

      body {
        padding-bottom: 0;
      }

      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .quick-actions {
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
      }
    }

    @media (min-width: 1024px) {
      .container {
        padding: 3rem;
      }

      h1 {
        font-size: 2.5rem;
      }

      .card {
        padding: 2.5rem;
      }
    }

    /* Animações de entrada melhoradas */
    #app-container {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .loaded #app-container {
      opacity: 1;
      transform: translateY(0);
    }

    /* Efeitos de loading nos botões */
    .button.loading {
      pointer-events: none;
      opacity: 0.7;
    }

    .button.loading::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* Scrollbar personalizada */
    .list-container::-webkit-scrollbar {
      width: 6px;
    }

    .list-container::-webkit-scrollbar-track {
      background: var(--gray-100);
      border-radius: 3px;
    }

    .list-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      border-radius: 3px;
    }

    .list-container::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
  </style>
</head>
<body>

<div class="container" id="app-container">
  <div id="loading" class="loading">
    <div class="spinner"></div>
  </div>

  <!-- Navegação Desktop -->
  <div class="tab-bar">
    <div class="tab-item active" onclick="showView('dashboard-view'); return false;">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7"/>
        <rect x="14" y="3" width="7" height="7"/>
        <rect x="14" y="14" width="7" height="7"/>
        <rect x="3" y="14" width="7" height="7"/>
      </svg>
      Dashboard
    </div>
    <div class="tab-item" onclick="showView('transacoes-view'); return false;">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 1v6"/>
        <path d="M12 17v6"/>
        <path d="M3 12h18"/>
        <path d="m19 16-4 4-4-4"/>
        <path d="m19 8-4-4-4 4"/>
      </svg>
      Transações
    </div>
    <div class="tab-item" onclick="showView('agendas-view'); return false;">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
        <path d="M8 14h.01"/>
        <path d="M12 14h.01"/>
        <path d="M16 14h.01"/>
        <path d="M8 18h.01"/>
        <path d="M12 18h.01"/>
        <path d="M16 18h.01"/>
      </svg>
      Agendas
    </div>
    <div class="tab-item" onclick="showView('reservas-view'); return false;">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
        <path d="M12 6v6l4 2"/>
      </svg>
      Reservas
    </div>
    <div class="tab-item" onclick="showView('categorias-view'); return false;">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
        <line x1="7" y1="7" x2="7.01" y2="7"/>
      </svg>
      Categorias
    </div>
  </div>

  <!-- Dashboard View -->
  <div id="dashboard-view" class="view">
    <h1>💼 Dashboard Financeiro</h1>
    
    <div class="kpi-grid">
      <div class="card kpi-card">
        <div class="kpi-value" id="saldo-liquido">R$ 0,00</div>
        <div class="kpi-label">💰 Saldo Líquido</div>
      </div>
    </div>

    <div class="quick-actions">
      <div class="quick-action-btn" onclick="openModal('modal-nova-transacao'); presetTransacaoTipo('Entrada')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="var(--success-color)" stroke-width="2.5">
          <path d="M12 5v14"/>
          <path d="M19 12l-7 7-7-7"/>
        </svg>
        <span>Nova Entrada</span>
      </div>
      <div class="quick-action-btn" onclick="openModal('modal-nova-transacao'); presetTransacaoTipo('Saída')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="var(--danger-color)" stroke-width="2.5">
          <path d="M12 19V5"/>
          <path d="M5 12l7-7 7 7"/>
        </svg>
        <span>Nova Saída</span>
      </div>
      <div class="quick-action-btn" onclick="openModal('modal-nova-agenda')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="var(--warning-color)" stroke-width="2.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
          <path d="M11 14h.01"/>
          <path d="M15 14h.01"/>
        </svg>
        <span>Agendar</span>
      </div>
      <div class="quick-action-btn" onclick="openModal('modal-nova-reserva')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2.5">
          <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
          <path d="M9 12l2 2 4-4"/>
        </svg>
        <span>Reservar</span>
      </div>
    </div>

    <div class="card">
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        Próximos Vencimentos
      </div>
      <div id="proximos-vencimentos" class="list-container">
        <div class="empty-state">
          <div>📅</div>
          <p>Nenhum vencimento agendado</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Transações View -->
  <div id="transacoes-view" class="view hidden">
    <h1>💳 Transações</h1>
    
    <button class="button is-fullwidth" onclick="openModal('modal-nova-transacao')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v8"/>
        <path d="M8 12h8"/>
      </svg>
      Nova Transação
    </button>

    <div class="card">
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 3h18v18H3z"/>
          <path d="M9 9h6v6H9z"/>
        </svg>
        Histórico de Transações
      </div>
      <div id="lista-transacoes" class="list-container"></div>
    </div>
  </div>

  <!-- Agendas View -->
  <div id="agendas-view" class="view hidden">
    <h1>📅 Agendamentos</h1>
    
    <button class="button is-fullwidth" onclick="openModal('modal-nova-agenda')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v8"/>
        <path d="M8 12h8"/>
      </svg>
      Novo Agendamento
    </button>

    <div class="card">
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        Agendamentos Ativos
      </div>
      <div id="lista-agendas" class="list-container"></div>
    </div>
  </div>

  <!-- Reservas View -->
  <div id="reservas-view" class="view hidden">
    <h1>💰 Reservas</h1>
    
    <button class="button is-fullwidth" onclick="openModal('modal-nova-reserva')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v8"/>
        <path d="M8 12h8"/>
      </svg>
      Nova Reserva
    </button>

    <div class="card">
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
          <path d="M9 12l2 2 4-4"/>
        </svg>
        Reservas Ativas
      </div>
      <div id="lista-reservas" class="list-container"></div>
    </div>
  </div>

  <!-- Categorias View -->
  <div id="categorias-view" class="view hidden">
    <h1>🏷️ Categorias</h1>
    
    <button class="button is-fullwidth" onclick="openModal('modal-nova-categoria')">
      <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 8v8"/>
        <path d="M8 12h8"/>
      </svg>
      Nova Categoria
    </button>

    <div class="card">
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
          <line x1="7" y1="7" x2="7.01" y2="7"/>
        </svg>
        Categorias Cadastradas
      </div>
      <div id="lista-categorias" class="list-container"></div>
    </div>
  </div>
</div>

<!-- Modais -->

<!-- Modal Nova Transação -->
<div id="modal-nova-transacao" class="modal hidden">
  <div class="modal-content">
    <div class="title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 1v6"/>
        <path d="M12 17v6"/>
        <path d="M3 12h18"/>
      </svg>
      Nova Transação
    </div>
    <form id="form-transacao">
      <div class="form-group">
        <label class="form-label">📅 Data da Transação</label>
        <input type="date" class="input" name="data_transacao" required>
      </div>
      <div class="form-group">
        <label class="form-label">🔄 Tipo</label>
        <select class="input" name="tipo" required>
          <option value="">Selecione...</option>
          <option value="Entrada">💰 Entrada</option>
          <option value="Saída">💸 Saída</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">🏷️ Categoria</label>
        <select class="input" name="categoria" id="categoria-transacao" required>
          <option value="">Selecione uma categoria...</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">📝 Descrição</label>
        <input type="text" class="input" name="descricao" required placeholder="Ex: Pagamento de cliente">
      </div>
      <div class="form-group">
        <label class="form-label">💵 Valor (R$)</label>
        <input type="number" class="input" name="valor" step="0.01" min="0" required placeholder="0,00">
      </div>
      <div class="form-row">
        <button type="button" class="button secondary" onclick="closeModal('modal-nova-transacao')">Cancelar</button>
        <button type="submit" class="button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
            <polyline points="17,21 17,13 7,13 7,21"/>
            <polyline points="7,3 7,8 15,8"/>
          </svg>
          Salvar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Nova Agenda -->
<div id="modal-nova-agenda" class="modal hidden">
  <div class="modal-content">
    <div class="title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
        <line x1="16" y1="2" x2="16" y2="6"/>
        <line x1="8" y1="2" x2="8" y2="6"/>
        <line x1="3" y1="10" x2="21" y2="10"/>
      </svg>
      Novo Agendamento
    </div>
    <form id="form-agenda">
      <div class="form-group">
        <label class="form-label">📅 Data de Vencimento</label>
        <input type="date" class="input" name="data_vencimento" required>
      </div>
      <div class="form-group">
        <label class="form-label">📝 Descrição</label>
        <input type="text" class="input" name="descricao" required placeholder="Ex: Pagamento de fornecedor">
      </div>
      <div class="form-group">
        <label class="form-label">🔄 Tipo</label>
        <select class="input" name="tipo" required>
          <option value="">Selecione...</option>
          <option value="Entrada">💰 Entrada</option>
          <option value="Saída">💸 Saída</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">💵 Valor Previsto (R$)</label>
        <input type="number" class="input" name="valor_previsto" step="0.01" min="0" required placeholder="0,00">
      </div>
      <div class="form-row">
        <button type="button" class="button secondary" onclick="closeModal('modal-nova-agenda')">Cancelar</button>
        <button type="submit" class="button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
            <polyline points="17,21 17,13 7,13 7,21"/>
            <polyline points="7,3 7,8 15,8"/>
          </svg>
          Agendar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Nova Reserva -->
<div id="modal-nova-reserva" class="modal hidden">
  <div class="modal-content">
    <div class="title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
        <path d="M9 12l2 2 4-4"/>
      </svg>
      Nova Reserva
    </div>
    <form id="form-reserva">
      <div class="form-group">
        <label class="form-label">📝 Descrição</label>
        <input type="text" class="input" name="descricao" required placeholder="Ex: Reserva para impostos">
      </div>
      <div class="form-group">
        <label class="form-label">💰 Valor a Reservar (R$)</label>
        <input type="number" class="input" name="valor_reservado" step="0.01" min="0" required placeholder="0,00">
      </div>
      <div class="form-row">
        <button type="button" class="button secondary" onclick="closeModal('modal-nova-reserva')">Cancelar</button>
        <button type="submit" class="button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
            <polyline points="17,21 17,13 7,13 7,21"/>
            <polyline points="7,3 7,8 15,8"/>
          </svg>
          Reservar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Nova Categoria -->
<div id="modal-nova-categoria" class="modal hidden">
  <div class="modal-content">
    <div class="title">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
        <line x1="7" y1="7" x2="7.01" y2="7"/>
      </svg>
      Nova Categoria
    </div>
    <form id="form-categoria">
      <div class="form-group">
        <label class="form-label">🏷️ Nome da Categoria</label>
        <input type="text" class="input" name="categoria" required placeholder="Ex: Vendas, Marketing, Impostos">
      </div>
      <div class="form-group">
        <label class="form-label">🔄 Tipo Padrão</label>
        <select class="input" name="tipoPadrao" required>
          <option value="">Selecione...</option>
          <option value="Entrada">💰 Entrada</option>
          <option value="Saída">💸 Saída</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">🏢 Centro de Custo (Opcional)</label>
        <input type="text" class="input" name="centroCusto" placeholder="Ex: Vendas, Administrativo">
      </div>
      <div class="form-row">
        <button type="button" class="button secondary" onclick="closeModal('modal-nova-categoria')">Cancelar</button>
        <button type="submit" class="button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
            <polyline points="17,21 17,13 7,13 7,21"/>
            <polyline points="7,3 7,8 15,8"/>
          </svg>
          Criar Categoria
        </button>
      </div>
    </form>
  </div>
</div>

<script>
// Variáveis globais
let currentView = 'dashboard-view';
let categorias = [];
let isLoading = false;

// Cache para performance
const cache = {
  dashboard: null,
  transacoes: null,
  agendas: null,
  reservas: null,
  lastUpdate: null
};

// Debounce para otimização
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Inicialização da aplicação
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
});

function initializeApp() {
  try {
    showLoading(true);
    
    // Configurar data padrão para hoje
    setDefaultDates();
    
    // Configurar event listeners
    setupEventListeners();
    
    // Carregar dados iniciais
    loadCategorias()
      .then(() => loadDashboard())
      .then(() => {
        // Mostrar a aplicação
        document.body.classList.add('loaded');
        showView('dashboard-view');
      })
      .catch(error => {
        console.error('Erro na inicialização:', error);
        showNotification('Erro ao carregar a aplicação', 'error');
      })
      .finally(() => {
        setTimeout(() => showLoading(false), 500);
      });
    
  } catch (error) {
    console.error('Erro na inicialização:', error);
    showNotification('Erro ao carregar a aplicação', 'error');
    showLoading(false);
  }
}

function showLoading(show) {
  const loading = document.getElementById('loading');
  if (show) {
    loading.classList.remove('hidden');
    isLoading = true;
  } else {
    loading.classList.add('hidden');
    isLoading = false;
  }
}

function setDefaultDates() {
  const today = new Date().toISOString().split('T')[0];
  const dateInputs = document.querySelectorAll('input[type="date"]');
  dateInputs.forEach(input => {
    if (!input.value) {
      input.value = today;
    }
  });
}

function setupEventListeners() {
  // Formulários
  document.getElementById('form-transacao').addEventListener('submit', handleTransacaoSubmit);
  document.getElementById('form-agenda').addEventListener('submit', handleAgendaSubmit);
  document.getElementById('form-reserva').addEventListener('submit', handleReservaSubmit);
  document.getElementById('form-categoria').addEventListener('submit', handleCategoriaSubmit);

  // Fechar modais clicando fora
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal')) {
      closeAllModals();
    }
  });

  // Escape para fechar modais
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeAllModals();
    }
  });
}

// Navegação entre views
function showView(viewId) {
  if (currentView === viewId) return;
  
  // Esconder todas as views
  document.querySelectorAll('.view').forEach(view => {
    view.classList.add('hidden');
  });
  
  // Mostrar a view selecionada
  const targetView = document.getElementById(viewId);
  targetView.classList.remove('hidden');
  
  // Atualizar navegação
  document.querySelectorAll('.tab-item').forEach(tab => {
    tab.classList.remove('active');
  });
  
  const activeTab = document.querySelector(`[onclick*="showView('${viewId}')"]`);
  if (activeTab) {
    activeTab.classList.add('active');
  }
  
  currentView = viewId;
  
  // Carregar dados específicos da view
  switch(viewId) {
    case 'dashboard-view':
      loadDashboard();
      break;
    case 'transacoes-view':
      loadTransacoes();
      break;
    case 'agendas-view':
      loadAgendas();
      break;
    case 'reservas-view':
      loadReservas();
      break;
    case 'categorias-view':
      loadCategoriasView();
      break;
  }
}

// Gerenciamento de modais
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.remove('hidden');
  
  // Carregar categorias nos selects se necessário
  if (modalId.includes('transacao')) {
    updateCategoriaSelects();
  }
  
  // Focus no primeiro input
  setTimeout(() => {
    const firstInput = modal.querySelector('input, select');
    if (firstInput) firstInput.focus();
  }, 300);
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.add('hidden');
  
  // Limpar formulário
  const form = modal.querySelector('form');
  if (form) {
    form.reset();
    setDefaultDates();
  }
}

function closeAllModals() {
  document.querySelectorAll('.modal').forEach(modal => {
    modal.classList.add('hidden');
    
    // Limpar formulários
    const form = modal.querySelector('form');
    if (form) {
      form.reset();
      setDefaultDates();
    }
  });
}

function presetTransacaoTipo(tipo) {
  setTimeout(() => {
    const tipoSelect = document.querySelector('#form-transacao select[name="tipo"]');
    if (tipoSelect) {
      tipoSelect.value = tipo;
    }
  }, 100);
}

// Carregamento de dados - REMOVIDOS OS DADOS MOCKADOS
function loadCategorias() {
  return new Promise((resolve, reject) => {
    google.script.run
      .withSuccessHandler(function(result) {
        if (result.success) {
          categorias = result.data || [];
          updateCategoriaSelects();
          resolve();
        } else {
          console.error('Erro nos dados de categorias:', result.error);
          showNotification('Erro ao carregar categorias', 'error');
          reject(result.error);
        }
      })
      .withFailureHandler(function(error) {
        console.error('Erro ao carregar categorias:', error);
        showNotification('Erro ao carregar categorias', 'error');
        reject(error);
      })
      .getCategorias();
  });
}

function updateCategoriaSelects() {
  const select = document.getElementById('categoria-transacao');
  if (select) {
    // Manter a opção padrão
    const defaultOption = select.querySelector('option[value=""]');
    select.innerHTML = '';
    if (defaultOption) select.appendChild(defaultOption);
    
    // Adicionar categorias
    categorias.forEach(categoria => {
      const option = document.createElement('option');
      option.value = categoria.categoria;
      option.textContent = `${categoria.tipoPadrao === 'Entrada' ? '💰' : '💸'} ${categoria.categoria}`;
      select.appendChild(option);
    });
  }
}

function loadDashboard() {
  return new Promise((resolve, reject) => {
    // Verificar cache
    if (cache.dashboard && cache.lastUpdate && (Date.now() - cache.lastUpdate < 30000)) {
      updateDashboard(cache.dashboard);
      resolve();
      return;
    }

    google.script.run
      .withSuccessHandler(function(result) {
        if (result.success) {
          cache.dashboard = result.data;
          cache.lastUpdate = Date.now();
          updateDashboard(result.data);
          resolve();
        } else {
          console.error('Erro nos dados do dashboard:', result.error);
          showNotification('Erro ao carregar dashboard', 'error');
          reject(result.error);
        }
      })
      .withFailureHandler(function(error) {
        console.error('Erro ao carregar dashboard:', error);
        showNotification('Erro ao carregar dashboard', 'error');
        reject(error);
      })
      .getDashboard();
  });
}

function updateDashboard(data) {
  // Atualizar saldo líquido com animação
  const saldoElement = document.getElementById('saldo-liquido');
  const saldo = data.kpis?.saldoLiquido || 0;
  
  // Animação de contagem
  animateValue(saldoElement, 0, saldo, 1000);
  
  // Atualizar próximos vencimentos
  const vencimentosContainer = document.getElementById('proximos-vencimentos');
  
  if (data.proximosVencimentos && data.proximosVencimentos.length > 0) {
    vencimentosContainer.innerHTML = '';
    data.proximosVencimentos.forEach((vencimento, index) => {
      setTimeout(() => {
        const item = createVencimentoItem(vencimento);
        vencimentosContainer.appendChild(item);
      }, index * 100);
    });
  } else {
    vencimentosContainer.innerHTML = `
      <div class="empty-state">
        <div>📅</div>
        <p>Nenhum vencimento agendado</p>
      </div>
    `;
  }
}

function animateValue(element, start, end, duration) {
  const range = end - start;
  const increment = range / (duration / 16);
  let current = start;
  
  const timer = setInterval(() => {
    current += increment;
    if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
      current = end;
      clearInterval(timer);
    }
    element.textContent = formatCurrency(current);
  }, 16);
}

function createVencimentoItem(vencimento) {
  const item = document.createElement('div');
  item.className = 'list-item';
  
  const dataVencimento = new Date(vencimento.data_vencimento);
  const hoje = new Date();
  hoje.setHours(0, 0, 0, 0);
  dataVencimento.setHours(0, 0, 0, 0);
  
  const diasRestantes = Math.ceil((dataVencimento - hoje) / (1000 * 60 * 60 * 24));
  
  let statusText = '';
  let statusIcon = '';
  if (diasRestantes === 0) {
    statusText = 'Hoje';
    statusIcon = '🔥';
  } else if (diasRestantes === 1) {
    statusText = 'Amanhã';
    statusIcon = '⚡';
  } else if (diasRestantes > 1) {
    statusText = `${diasRestantes} dias`;
    statusIcon = '📅';
  } else {
    statusText = 'Vencido';
    statusIcon = '⚠️';
  }
  
  item.innerHTML = `
    <div class="item-info">
      <div class="item-label">${vencimento.descricao}</div>
      <div class="item-description">
        ${statusIcon} ${statusText} - ${vencimento.tipo === 'Entrada' ? '💰' : '💸'} ${vencimento.tipo}
      </div>
    </div>
    <div class="item-value ${vencimento.tipo === 'Entrada' ? 'positive' : 'negative'}">
      ${formatCurrency(vencimento.valor_previsto)}
    </div>
  `;
  
  // Animação de entrada
  item.style.opacity = '0';
  item.style.transform = 'translateX(-20px)';
  
  setTimeout(() => {
    item.style.transition = 'all 0.3s ease-out';
    item.style.opacity = '1';
    item.style.transform = 'translateX(0)';
  }, 50);
  
  return item;
}

function loadTransacoes() {
  console.log('Carregando transações...');
  
  google.script.run
    .withSuccessHandler(function(result) {
      console.log('Resultado das transações:', result);
      if (result.success) {
        cache.transacoes = result.data;
        updateTransacoesList(result.data || []);
      } else {
        console.error('Erro nos dados de transações:', result.error);
        showNotification('Erro ao carregar transações: ' + result.error, 'error');
        updateTransacoesList([]);
      }
    })
    .withFailureHandler(function(error) {
      console.error('Erro ao carregar transações:', error);
      showNotification('Erro ao carregar transações: ' + error.message, 'error');
      updateTransacoesList([]);
    })
    .getTransacoes();
}

function updateTransacoesList(transacoes) {
  const container = document.getElementById('lista-transacoes');
  
  if (!transacoes || transacoes.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div>💳</div>
        <p>Nenhuma transação registrada</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = '';
  
  // Ordenar por data (mais recente primeiro)
  const transacoesOrdenadas = transacoes.sort((a, b) => new Date(b.data_transacao) - new Date(a.data_transacao));
  
  transacoesOrdenadas.forEach((transacao, index) => {
    setTimeout(() => {
      const item = document.createElement('div');
      item.className = 'list-item';
      
      const data = new Date(transacao.data_transacao).toLocaleDateString('pt-BR');
      
      item.innerHTML = `
        <div class="item-info">
          <div class="item-label">${transacao.descricao}</div>
          <div class="item-description">
            📅 ${data} - 🏷️ ${transacao.categoria}
          </div>
        </div>
        <div class="item-value ${transacao.tipo === 'Entrada' ? 'positive' : 'negative'}">
          ${transacao.tipo === 'Entrada' ? '+' : '-'} ${formatCurrency(Math.abs(transacao.valor))}
        </div>
      `;
      
      // Animação de entrada
      item.style.opacity = '0';
      item.style.transform = 'translateY(20px)';
      container.appendChild(item);
      
      requestAnimationFrame(() => {
        item.style.transition = 'all 0.3s ease-out';
        item.style.opacity = '1';
        item.style.transform = 'translateY(0)';
      });
    }, index * 50);
  });
}

function loadAgendas() {
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        cache.agendas = result.data;
        updateAgendasList(result.data || []);
      } else {
        console.error('Erro nos dados de agendas:', result.error);
        showNotification('Erro ao carregar agendas', 'error');
        updateAgendasList([]);
      }
    })
    .withFailureHandler(function(error) {
      console.error('Erro ao carregar agendas:', error);
      showNotification('Erro ao carregar agendas', 'error');
      updateAgendasList([]);
    })
    .getAgendas();
}

function updateAgendasList(agendas) {
  const container = document.getElementById('lista-agendas');
  
  if (!agendas || agendas.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div>📅</div>
        <p>Nenhum agendamento criado</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = '';
  
  // Filtrar apenas pendentes e ordenar por data
  const agendasPendentes = agendas
    .filter(agenda => agenda.status === 'Pendente')
    .sort((a, b) => new Date(a.data_vencimento) - new Date(b.data_vencimento));
  
  if (agendasPendentes.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div>✅</div>
        <p>Todos os agendamentos foram concluídos</p>
      </div>
    `;
    return;
  }
  
  agendasPendentes.forEach((agenda, index) => {
    setTimeout(() => {
      const item = document.createElement('div');
      item.className = 'list-item';
      
      const data = new Date(agenda.data_vencimento).toLocaleDateString('pt-BR');
      
      item.innerHTML = `
        <div class="item-info">
          <div class="item-label">${agenda.descricao}</div>
          <div class="item-description">
            📅 ${data} - ${agenda.tipo === 'Entrada' ? '💰' : '💸'} ${agenda.tipo}
          </div>
        </div>
        <div class="item-value ${agenda.tipo === 'Entrada' ? 'positive' : 'negative'}">
          ${formatCurrency(agenda.valor_previsto)}
        </div>
      `;
      
      // Animação de entrada
      item.style.opacity = '0';
      item.style.transform = 'translateY(20px)';
      container.appendChild(item);
      
      requestAnimationFrame(() => {
        item.style.transition = 'all 0.3s ease-out';
        item.style.opacity = '1';
        item.style.transform = 'translateY(0)';
      });
    }, index * 50);
  });
}

function loadReservas() {
  google.script.run
    .withSuccessHandler(function(result) {
      if (result.success) {
        cache.reservas = result.data;
        updateReservasList(result.data || []);
      } else {
        console.error('Erro nos dados de reservas:', result.error);
        showNotification('Erro ao carregar reservas', 'error');
        updateReservasList([]);
      }
    })
    .withFailureHandler(function(error) {
      console.error('Erro ao carregar reservas:', error);
      showNotification('Erro ao carregar reservas', 'error');
      updateReservasList([]);
    })
    .getReservas();
}

function updateReservasList(reservas) {
  const container = document.getElementById('lista-reservas');
  
  if (!reservas || reservas.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div>💰</div>
        <p>Nenhuma reserva criada</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = '';
  
  // Ordenar por data (mais recente primeiro)
  const reservasOrdenadas = reservas.sort((a, b) => new Date(b.data_reserva) - new Date(a.data_reserva));
  
  reservasOrdenadas.forEach((reserva, index) => {
    setTimeout(() => {
      const item = document.createElement('div');
      item.className = 'list-item';
      
      const data = new Date(reserva.data_reserva).toLocaleDateString('pt-BR');
      
      item.innerHTML = `
        <div class="item-info">
          <div class="item-label">${reserva.descricao}</div>
          <div class="item-description">📅 Criada em ${data}</div>
        </div>
        <div class="item-value positive">
          ${formatCurrency(reserva.valor_reservado)}
        </div>
      `;
      
      // Animação de entrada
      item.style.opacity = '0';
      item.style.transform = 'translateY(20px)';
      container.appendChild(item);
      
      requestAnimationFrame(() => {
        item.style.transition = 'all 0.3s ease-out';
        item.style.opacity = '1';
        item.style.transform = 'translateY(0)';
      });
    }, index * 50);
  });
}

function loadCategoriasView() {
  loadCategorias().then(() => {
    setTimeout(() => updateCategoriasView(), 300);
  }).catch(error => {
    console.error('Erro ao carregar categorias para a view:', error);
    updateCategoriasView();
  });
}

function updateCategoriasView() {
  const container = document.getElementById('lista-categorias');
  
  if (!categorias || categorias.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div>🏷️</div>
        <p>Nenhuma categoria cadastrada</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = '';
  
  categorias.forEach((categoria, index) => {
    setTimeout(() => {
      const item = document.createElement('div');
      item.className = 'list-item';
      
      item.innerHTML = `
        <div class="item-info">
          <div class="item-label">${categoria.categoria}</div>
          <div class="item-description">
            ${categoria.tipoPadrao === 'Entrada' ? '💰' : '💸'} Tipo padrão: ${categoria.tipoPadrao}
            ${categoria.centroCusto ? ' - 🏢 ' + categoria.centroCusto : ''}
          </div>
        </div>
        <div class="item-value">
          ${categoria.ativo ? '✅ Ativa' : '❌ Inativa'}
        </div>
      `;
      
      // Animação de entrada
      item.style.opacity = '0';
      item.style.transform = 'translateY(20px)';
      container.appendChild(item);
      
      requestAnimationFrame(() => {
        item.style.transition = 'all 0.3s ease-out';
        item.style.opacity = '1';
        item.style.transform = 'translateY(0)';
      });
    }, index * 50);
  });
}

// Handlers de formulários com debug melhorado
function handleTransacaoSubmit(e) {
  e.preventDefault();
  if (isLoading) return;
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  submitBtn.classList.add('loading');
  
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  
  // Debug: Verificar dados antes de enviar
  console.log('Dados da transação:', data);
  
  // Validações extras no frontend
  if (!data.data_transacao || !data.tipo || !data.categoria || !data.descricao || !data.valor) {
    submitBtn.classList.remove('loading');
    showNotification('Por favor, preencha todos os campos obrigatórios', 'error');
    return;
  }
  
  if (isNaN(data.valor) || parseFloat(data.valor) <= 0) {
    submitBtn.classList.remove('loading');
    showNotification('Valor deve ser um número positivo', 'error');
    return;
  }
  
  google.script.run
    .withSuccessHandler(function(result) {
      submitBtn.classList.remove('loading');
      console.log('Resultado do backend:', result);
      
      if (result.success) {
        showNotification('Transação salva com sucesso!', 'success');
        closeAllModals();
        
        // Invalidar cache
        cache.dashboard = null;
        cache.transacoes = null;
        
        // Recarregar dados relevantes
        setTimeout(() => {
          if (currentView === 'dashboard-view') {
            loadDashboard();
          } else if (currentView === 'transacoes-view') {
            loadTransacoes();
          }
        }, 500);
      } else {
        showNotification(result.error || 'Erro ao salvar transação', 'error');
      }
    })
    .withFailureHandler(function(error) {
      submitBtn.classList.remove('loading');
      console.error('Erro na chamada do Google Script:', error);
      showNotification('Erro de comunicação com o servidor: ' + error.message, 'error');
    })
    .salvarTransacao({
      data_transacao: data.data_transacao,
      tipo: data.tipo,
      categoria: data.categoria,
      descricao: data.descricao,
      valor: parseFloat(data.valor)
    });
}

function handleAgendaSubmit(e) {
  e.preventDefault();
  if (isLoading) return;
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  submitBtn.classList.add('loading');
  
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  
  google.script.run
    .withSuccessHandler(function(result) {
      submitBtn.classList.remove('loading');
      if (result.success) {
        showNotification('Agendamento salvo com sucesso!', 'success');
        closeAllModals();
        
        // Invalidar cache
        cache.dashboard = null;
        cache.agendas = null;
        
        // Recarregar dados relevantes
        if (currentView === 'dashboard-view') {
          loadDashboard();
        } else if (currentView === 'agendas-view') {
          loadAgendas();
        }
      } else {
        showNotification(result.error || 'Erro ao salvar agendamento', 'error');
      }
    })
    .withFailureHandler(function(error) {
      submitBtn.classList.remove('loading');
      console.error('Erro ao salvar agendamento:', error);
      showNotification('Erro ao salvar agendamento', 'error');
    })
    .salvarAgenda({
      ...data,
      valor_previsto: parseFloat(data.valor_previsto)
    });
}

function handleReservaSubmit(e) {
  e.preventDefault();
  if (isLoading) return;
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  submitBtn.classList.add('loading');
  
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  
  google.script.run
    .withSuccessHandler(function(result) {
      submitBtn.classList.remove('loading');
      if (result.success) {
        showNotification('Reserva salva com sucesso!', 'success');
        closeAllModals();
        
        // Invalidar cache
        cache.reservas = null;
        
        // Recarregar dados relevantes
        if (currentView === 'reservas-view') {
          loadReservas();
        }
      } else {
        showNotification(result.error || 'Erro ao salvar reserva', 'error');
      }
    })
    .withFailureHandler(function(error) {
      submitBtn.classList.remove('loading');
      console.error('Erro ao salvar reserva:', error);
      showNotification('Erro ao salvar reserva', 'error');
    })
    .salvarReserva({
      ...data,
      valor_reservado: parseFloat(data.valor_reservado)
    });
}

function handleCategoriaSubmit(e) {
  e.preventDefault();
  if (isLoading) return;
  
  const submitBtn = e.target.querySelector('button[type="submit"]');
  submitBtn.classList.add('loading');
  
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  
  google.script.run
    .withSuccessHandler(function(result) {
      submitBtn.classList.remove('loading');
      if (result.success) {
        showNotification('Categoria criada com sucesso!', 'success');
        closeAllModals();
        
        // Recarregar categorias
        loadCategorias().then(() => {
          // Atualizar view se estiver na tela de categorias
          if (currentView === 'categorias-view') {
            setTimeout(() => updateCategoriasView(), 300);
          }
        });
      } else {
        showNotification(result.error || 'Erro ao criar categoria', 'error');
      }
    })
    .withFailureHandler(function(error) {
      submitBtn.classList.remove('loading');
      console.error('Erro ao salvar categoria:', error);
      showNotification('Erro ao salvar categoria', 'error');
    })
    .salvarCategoria({
      ...data,
      ativo: true
    });
}

// Utilitários
function formatCurrency(value) {
  if (typeof value !== 'number' || isNaN(value)) {
    value = 0;
  }
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(value);
}

function showNotification(message, type = 'success') {
  // Remover notificação existente
  const existingNotification = document.querySelector('.notification');
  if (existingNotification) {
    existingNotification.style.transform = 'translateX(100%)';
    setTimeout(() => existingNotification.remove(), 200);
  }

  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  
  // Adicionar ícone baseado no tipo
  const icon = type === 'success' ? '✅' : '❌';
  notification.innerHTML = `
    <div style="display: flex; align-items: center; gap: 0.5rem;">
      <span>${icon}</span>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(notification);

  // Auto-remover com animação
  setTimeout(() => {
    if (notification.parentNode) {
      notification.style.transform = 'translateX(100%)';
      notification.style.opacity = '0';
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 300);
    }
  }, 3000);
}

// Tratamento de erros global
window.addEventListener('error', function(e) {
  console.error('Erro JavaScript:', e.error);
  showNotification('Ocorreu um erro inesperado', 'error');
});

// Verificação de conectividade com Google Apps Script
function checkGoogleScriptConnection() {
  if (typeof google === 'undefined' || !google.script) {
    showNotification('Conexão com Google Apps Script não disponível', 'error');
    return false;
  }
  return true;
}

// Inicialização com verificação de ambiente
function safeInitialize() {
  if (!checkGoogleScriptConnection()) {
    // Se não há conexão com Google Apps Script, mostrar erro
    document.getElementById('app-container').innerHTML = `
      <div class="card" style="text-align: center; margin-top: 2rem;">
        <h2 style="color: var(--danger-color);">⚠️ Erro de Conexão</h2>
        <p>Esta aplicação precisa estar executando no Google Apps Script para funcionar corretamente.</p>
        <p>Verifique se o script foi implantado adequadamente e tente novamente.</p>
      </div>
    `;
    showLoading(false);
    return;
  }
  
  initializeApp();
}

// Substituir a inicialização padrão
document.addEventListener('DOMContentLoaded', safeInitialize);

</script>

</body>
</html>